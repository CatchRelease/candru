var Emitter,noop,slice=[].slice,bind=function(e,t){return function(){return e.apply(t,arguments)}},extend1=function(e,t){function a(){this.constructor=e}for(var l in t)hasProp.call(t,l)&&(e[l]=t[l]);return a.prototype=t.prototype,e.prototype=new a,e.__super__=t.prototype,e},hasProp={}.hasOwnProperty;noop=function(){},Emitter=function(){function e(){}return e.prototype.addEventListener=e.prototype.on,e.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},e.prototype.emit=function(){var e,t,a,l,n,i;if(l=arguments[0],e=2<=arguments.length?slice.call(arguments,1):[],this._callbacks=this._callbacks||{},a=this._callbacks[l])for(n=0,i=a.length;i>n;n++)t=a[n],t.apply(this,e);return this},e.prototype.removeListener=e.prototype.off,e.prototype.removeAllListeners=e.prototype.off,e.prototype.removeEventListener=e.prototype.off,e.prototype.off=function(e,t){var a,l,n,i,r;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(l=this._callbacks[e],!l)return this;if(1===arguments.length)return delete this._callbacks[e],this;for(n=i=0,r=l.length;r>i;n=++i)if(a=l[n],a===t){l.splice(n,1);break}return this},e}(),window.Candru=function(e){function t(e,t){var a;if(null==t&&(t={}),this.uploadError=bind(this.uploadError,this),this.uploadWarn=bind(this.uploadWarn,this),this.uploadInfo=bind(this.uploadInfo,this),this.uploadCancel=bind(this.uploadCancel,this),this.uploadProgress=bind(this.uploadProgress,this),this.uploadComplete=bind(this.uploadComplete,this),this.uploadHandler=bind(this.uploadHandler,this),this.dropHandler=bind(this.dropHandler,this),this.createUploadItem=bind(this.createUploadItem,this),this.getCancelEl=bind(this.getCancelEl,this),this.getMeterEl=bind(this.getMeterEl,this),this.leaveHandler=bind(this.leaveHandler,this),this.overHandler=bind(this.overHandler,this),a={debug:!1,queue:!1,overClass:"candru-over",cancelSelector:".cancel",uploadSuccessClass:"done",uploadFailedClass:"failed",uploadCancelledClass:"cancelled",allowedTypes:[/^image\//,/^video\//],maxFileSize:4294967296,evaporate:null,sanitizeFilename:this.sanitizeFilename,renameFile:this.renameFile,overHandler:this.overHandler,leaveHandler:this.leaveHandler,dropHandler:this.dropHandler,getMeterEl:this.getMeterEl,getCancelEl:this.getCancelEl,uploadHandler:this.uploadHandler,uploadComplete:this.uploadComplete,uploadStartCallback:noop,uploadCompleteCallback:noop,uploadProgress:this.uploadProgress,uploadCancel:this.uploadCancel,uploadInfo:this.uploadInfo,uploadWarn:this.uploadWarn,uploadError:this.uploadError,createUploadItem:this.createUploadItem},this._index=0,this._complete=0,this._cancelled=0,this._failed=0,this._fileQueue=[],this.defaults=l(a,t),this.el=window.document.querySelector(e),!this.el)throw new Error("Could not find element for uploader.");this.init()}var a,l,n,i,r;return extend1(t,e),l=function(e,t){var a,l;for(a in t)l=t[a],e[a]=l;return e},a=function(e,t){return e.classList?e.classList.add(t):e.className+=" "+t},r=function(e,t){return e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},n=function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},i=function(e){var t;return 0===e?"0.00 B":(t=Math.floor(Math.log(e)/Math.log(1024)),(e/Math.pow(1024,t)).toFixed(2)+" "+" KMGTP".charAt(t)+"B")},t.prototype.init=function(){return this.el.addEventListener("dragover",this.defaults.overHandler),this.el.addEventListener("dragleave",this.defaults.leaveHandler),this.el.addEventListener("drop",this.defaults.dropHandler)},t.prototype.overHandler=function(e){return e.preventDefault(),e.stopPropagation(),this.emit("candru-dragover",e),a(this.el,this.defaults.overClass),!1},t.prototype.leaveHandler=function(e){return e.preventDefault(),e.stopPropagation(),this.emit("candru-dragleave",e),r(this.el,this.defaults.overClass),!1},t.prototype.fileTypeCheck=function(e){var t,a,l,n,i;for(t=!1,n=this.defaults.allowedTypes,a=0,l=n.length;l>a;a++)if(i=n[a],i.test(e.type)){t=!0;break}return t},t.prototype.fileSizeCheck=function(e){return e.size>this.defaults.maxFileSize?!1:!0},t.prototype.sanitizeFilename=function(e){var t,a,l,n,i,r;return i=/\ /g,a=/[\/\?<>\\:\*\|":]/g,t=/[\x00-\x1f\x80-\x9f]/g,n=/^\.+$/,r=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,l="",e.name.toLowerCase().replace(i,"_").replace(a,l).replace(t,l).replace(n,l).replace(r,l)},t.prototype.renameFile=function(e){return e.name},t.prototype.getMeterEl=function(e){var t;return t='.candru [data-upload-id="'+e+'"] .meter',this.el.querySelector(t)},t.prototype.getCancelEl=function(e){var t;return t='.candru [data-upload-id="'+e+'"] .cancel',this.el.querySelector(t)},t.prototype.createUploadItem=function(e,t){var a;return a=document.createElement("div"),a.className="candru-upload clearfix",a.dataset.uploadId=t,a.innerHTML="<button class='cancel left tiny'>Cancel</button>\n<span class='filename left'>\n  <label>\n      File:\n  </label>\n  "+e.name+"\n</span>\n<span class='filesize left'>\n  <label>\n      Size:\n  </label>\n  "+i(e.size)+"\n</span>\n<div class='candru-progress right'>\n  <span class='meter'></span>\n</div>",a.querySelector(this.defaults.cancelSelector).addEventListener("click",function(a){return function(l){return function(t){return a.defaults.uploadCancel(e,t)}(t)}}(this)),a},t.prototype.dropHandler=function(e){var t,a,l,n,i;for(e.preventDefault(),e.stopPropagation(),this.emit("candru-drop",e),r(this.el,this.defaults.overClass),a=e.dataTransfer.files,l=0,n=a.length;n>l;l++)t=a[l],this.fileTypeCheck(t)?this.fileSizeCheck(t)?(i=this.defaults.createUploadItem(t,this._index),this.el.appendChild(i),t.uniqueId=Math.random().toString(36).substr(2,16),t.sanitizedFileName=this.defaults.sanitizeFilename(t),t.uploadName=this.defaults.renameFile(t),this.defaults.queue?(this.emit("candru-queue-add",t,this._index,"unprocessed"),this._fileQueue.push({file:t,index:this._index,state:"unprocessed"})):(this.emit("candru-process",t,this._index),this.defaults.uploadHandler(t,this._index)),this._index++):console.log("Skipping file of size: ",t.size):console.log("Skipping file of type: ",t.type);return!1},t.prototype.uploadHandler=function(e,t){var a;if(!this.defaults.evaporate)throw new Error("Evaporate instance is null.");return a=this.defaults.evaporate,this.defaults.uploadStartCallback(e,t,this.allFilesFinished()),a.add({name:e.uploadName,file:e,complete:function(a){return function(){return a.emit("candru-evaporate-complete",e,t),a.defaults.uploadComplete(e,t)}}(this),progress:function(a){return function(l){return a.emit("candru-evaporate-complete",l,e,t),a.defaults.uploadProgress(l,e,t)}}(this),info:function(a){return function(l){return a.emit("candru-evaporate-info",l,e,t),a.defaults.uploadInfo(l,e,t)}}(this),warn:function(a){return function(l){return a.emit("candru-evaporate-warn",l,e,t),a.defaults.uploadWarn(l,e,t)}}(this),error:function(a){return function(l){return a.emit("candru-evaporate-error",l,e,t),a.defaults.uploadError(l,e,t)}}(this)})},t.prototype.uploadComplete=function(e,t){var l,n;return this._complete++,n=this.defaults.getMeterEl(t),n.style.width="100%",a(n,this.defaults.uploadSuccessClass),l=this.defaults.getCancelEl(t),a(l,"disabled"),this.defaults.uploadCompleteCallback(e,t,this.allFilesFinished())},t.prototype.uploadProgress=function(e,t,a){var l;return l=this.defaults.getMeterEl(a),l.style.width=100*e+"%"},t.prototype.uploadCancel=function(e,t){var l,i,r,s,o,u,d;if(l=this.defaults.getCancelEl(t),!n(l,"disabled")){if(this._cancelled++,!this.defaults.evaporate)throw new Error("Evaporate instance is null.");if(i=this.defaults.evaporate,d=this.defaults.getMeterEl(t),a(d,this.defaults.uploadCancelledClass),d.style.width="100%",l=this.defaults.getCancelEl(t),a(l,"disabled"),this.defaults.queue)for(u=this._fileQueue,r=0,s=u.length;s>r;r++)o=u[r],o.index===t&&(o.state="cancelled");return i.cancel(t)}},t.prototype.uploadInfo=function(e,t,a){return this.defaults.debug?console.log("INFO: File:",t,"Index:",a,"Message:",e):void 0},t.prototype.uploadWarn=function(e,t,a){return this.defaults.debug?console.log("WARN: File:",t,"Index:",a,"Message:",e):void 0},t.prototype.uploadError=function(e,t,l){var n;return this.defaults.debug&&console.log("ERROR: File:",t,"Index:",l,"Message:",e),this._failed++,n=this.getMeterEl(l),a(n,this.defaults.uploadFailedClass)},t.prototype.processQueue=function(){var e,t,a,l,n;if(!this.defaults.queue)return!1;for(l=this._fileQueue,n=[],e=0,t=l.length;t>e;e++)a=l[e],"unprocessed"===a.state&&(this.defaults.uploadHandler(a.file,a.index),n.push(a.state="processed"));return n},t.prototype.cancelAll=function(){var e,t,a,l,i,r,s,o,u;for(e=this.el.querySelectorAll(this.defaults.cancelSelector),t=0,l=e.length;l>t;t++)u=e[t],n(u,"disabled")||u.click();if(this.defaults.queue){for(s=this._fileQueue,o=[],a=0,i=s.length;i>a;a++)r=s[a],"unprocessed"===r.state?(this.emit("candru-queue-cancelled",r.file,r.index,"cancelled"),o.push(r.state="cancelled")):o.push(void 0);return o}},t.prototype.getFileCount=function(){return this._index},t.prototype.allFilesFinished=function(){return this._index===this._complete+this._failed+this._cancelled},t}(Emitter);