var bind=function(e,t){return function(){return e.apply(t,arguments)}};window.Candru=function(){function e(e,t){var a;if(null==t&&(t={}),this.uploadError=bind(this.uploadError,this),this.uploadWarn=bind(this.uploadWarn,this),this.uploadInfo=bind(this.uploadInfo,this),this.uploadCancel=bind(this.uploadCancel,this),this.uploadProgress=bind(this.uploadProgress,this),this.uploadComplete=bind(this.uploadComplete,this),this.uploadHandler=bind(this.uploadHandler,this),this.dropHandler=bind(this.dropHandler,this),this.createUploadItem=bind(this.createUploadItem,this),this.getCancelEl=bind(this.getCancelEl,this),this.getMeterEl=bind(this.getMeterEl,this),this.leaveHandler=bind(this.leaveHandler,this),this.overHandler=bind(this.overHandler,this),a={debug:!1,queue:!1,overClass:"candru-over",cancelSelector:".cancel",uploadSuccessClass:"done",uploadFailedClass:"failed",uploadCancelledClass:"cancelled",allowedTypes:[/^image\//,/^video\//],maxFileSize:4294967296,evaporate:null,sanitizeFilename:this.sanitizeFilename,overHandler:this.overHandler,leaveHandler:this.leaveHandler,dropHandler:this.dropHandler,getMeterEl:this.getMeterEl,getCancelEl:this.getCancelEl,uploadHandler:this.uploadHandler,uploadComplete:this.uploadComplete,uploadProgress:this.uploadProgress,uploadCancel:this.uploadCancel,uploadInfo:this.uploadInfo,uploadWarn:this.uploadWarn,uploadError:this.uploadError,createUploadItem:this.createUploadItem},this._index=0,this._complete=0,this._cancelled=0,this._failed=0,this._fileQueue=[],this.defaults=l(a,t),this.el=window.document.querySelector(e),!this.el)throw new Error("Could not find element for uploader.");this.init()}var t,l,a,s,n;return l=function(e,t){var l,a;for(l in t)a=t[l],e[l]=a;return e},t=function(e,t){return e.classList?e.classList.add(t):e.className+=" "+t},n=function(e,t){return e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},a=function(e,t){return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)},s=function(e){var t;return 0===e?"0.00 B":(t=Math.floor(Math.log(e)/Math.log(1024)),(e/Math.pow(1024,t)).toFixed(2)+" "+" KMGTP".charAt(t)+"B")},e.prototype.init=function(){return this.el.addEventListener("dragover",this.defaults.overHandler),this.el.addEventListener("dragleave",this.defaults.leaveHandler),this.el.addEventListener("drop",this.defaults.dropHandler)},e.prototype.overHandler=function(e){return e.preventDefault(),e.stopPropagation(),t(this.el,this.defaults.overClass),!1},e.prototype.leaveHandler=function(e){return e.preventDefault(),e.stopPropagation(),n(this.el,this.defaults.overClass),!1},e.prototype.fileTypeCheck=function(e){var t,l,a,s,n;for(t=!1,s=this.defaults.allowedTypes,l=0,a=s.length;a>l;l++)if(n=s[l],n.test(e.type)){t=!0;break}return t},e.prototype.fileSizeCheck=function(e){return e.size>this.defaults.maxFileSize?!1:!0},e.prototype.sanitizeFilename=function(e){var t,l,a,s,n,i;return n=/\ /g,l=/[\/\?<>\\:\*\|":]/g,t=/[\x00-\x1f\x80-\x9f]/g,s=/^\.+$/,i=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,a="",e.name.replace(n,"_").replace(l,a).replace(t,a).replace(s,a).replace(i,a)},e.prototype.getMeterEl=function(e){var t;return t='.candru [data-upload-id="'+e+'"] .meter',this.el.querySelector(t)},e.prototype.getCancelEl=function(e){var t;return t='.candru [data-upload-id="'+e+'"] .cancel',this.el.querySelector(t)},e.prototype.createUploadItem=function(e,t){var l;return l=document.createElement("div"),l.className="candru-upload clearfix",l.dataset.uploadId=t,l.innerHTML="<span class='cancel left'><a href='#'>&cross;</a></span><span class='filename left'><label>File:</label>"+e.name+"</span><span class='filesize left'><label>Size:</label>"+s(e.size)+"</span><div class='candru-progress right'><span class='meter'></span></div>",l.querySelector(this.defaults.cancelSelector).addEventListener("click",function(l){return function(a){return function(t){return l.defaults.uploadCancel(e,t)}(t)}}(this)),l},e.prototype.dropHandler=function(e){var t,l,a,s,i;for(e.preventDefault(),e.stopPropagation(),n(this.el,this.defaults.overClass),l=e.dataTransfer.files,a=0,s=l.length;s>a;a++)t=l[a],this.fileTypeCheck(t)?this.fileSizeCheck(t)?(i=this.defaults.createUploadItem(t,this._index),this.el.appendChild(i),this.defaults.queue?this._fileQueue.push({file:t,index:this._index,state:"unprocessed"}):this.defaults.uploadHandler(t,this._index),this._index++):console.log("Skipping file of size: ",t.size):console.log("Skipping file of type: ",t.type);return!1},e.prototype.uploadHandler=function(e,t){var l;if(!this.defaults.evaporate)throw new Error("Evaporate instance is null.");return l=this.defaults.evaporate,l.add({name:this.defaults.sanitizeFilename(e),file:e,complete:function(l){return function(){return l.defaults.uploadComplete(e,t)}}(this),progress:function(l){return function(a){return l.defaults.uploadProgress(a,e,t)}}(this),info:function(l){return function(a){return l.defaults.uploadInfo(a,e,t)}}(this),warn:function(l){return function(a){return l.defaults.uploadWarn(a,e,t)}}(this),error:function(l){return function(a){return l.defaults.uploadError(a,e,t)}}(this)})},e.prototype.uploadComplete=function(e,l){var a,s;return this._complete++,s=this.defaults.getMeterEl(l),s.style.width="100%",t(s,this.defaults.uploadSuccessClass),a=this.defaults.getCancelEl(l),t(a.querySelector("a"),"hidden")},e.prototype.uploadProgress=function(e,t,l){var a;return a=this.defaults.getMeterEl(l),a.style.width=100*e+"%"},e.prototype.uploadCancel=function(e,l){var a,s,n,i,r,o,u;if(this._cancelled++,!this.defaults.evaporate)throw new Error("Evaporate instance is null.");if(s=this.defaults.evaporate,u=this.defaults.getMeterEl(l),t(u,this.defaults.uploadCancelledClass),u.style.width="100%",a=this.defaults.getCancelEl(l),t(a.querySelector("a"),"hidden"),this.defaults.queue)for(o=this._fileQueue,n=0,i=o.length;i>n;n++)r=o[n],r.index===l&&(r.state="cancelled");return s.cancel(l)},e.prototype.uploadInfo=function(e,t,l){return this.defaults.debug?console.log("INFO: File:",t,"Index:",l,"Message:",e):void 0},e.prototype.uploadWarn=function(e,t,l){return this.defaults.debug?console.log("WARN: File:",t,"Index:",l,"Message:",e):void 0},e.prototype.uploadError=function(e,l,a){var s;return this.defaults.debug&&console.log("ERROR: File:",l,"Index:",a,"Message:",e),this._failed++,s=this.getMeterEl(a),t(s,this.defaults.uploadFailedClass)},e.prototype.processQueue=function(){var e,t,l,a,s;if(!this.defaults.queue)return!1;for(a=this._fileQueue,s=[],e=0,t=a.length;t>e;e++)l=a[e],"unprocessed"===l.state&&(this.defaults.uploadHandler(l.file,l.index),s.push(l.state="processed"));return s},e.prototype.cancelAll=function(){var e,t,l,s,n,i,r,o,u;for(e=this.el.querySelectorAll(this.defaults.cancelSelector+" a"),t=0,s=e.length;s>t;t++)u=e[t],console.log(u,a(u,"hidden")),a(u,"hidden")||u.click();if(this.defaults.queue){for(r=this._fileQueue,o=[],l=0,n=r.length;n>l;l++)i=r[l],"unprocessed"===i.state?o.push(i.state="cancelled"):o.push(void 0);return o}},e.prototype.getFileCount=function(){return this._index},e.prototype.allFilesFinished=function(){return this._index===this._complete+this._failed+this._cancelled},e}();